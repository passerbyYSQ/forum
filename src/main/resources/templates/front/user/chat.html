<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>在线聊天</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" th:href="@{/admin/assets/libs/layui/css/layui.css}" href="../res/layui/css/layui.css">
    <link rel="stylesheet" th:href="@{/admin/assets/module/admin.css(v=318)}" href="admin/assets/module/admin.css?v=318">
    <link rel="stylesheet" th:href="@{/front/res/css/global.css}" href="../res/css/global.css">
    <style>
        .layim-status-hide {
            color: #fda56c !important;
        }
    </style>
</head>
<body>

<div th:replace="~{front/common/common :: frontHeader(${loginUser})}"></div>

<div class="layui-container fly-marginTop fly-user-main">
    <div th:replace="~{front/common/common :: userCenterSidebar('chat')}"></div>
    <div th:replace="~{front/common/common :: userCenterHideDom}"></div>
    <div class="fly-panel fly-panel-user" pad20>
        <div class="layui-tab layui-tab-brief" lay-filter="user" id="LAY_msg" style="margin-top: 15px;">
            <div class="layui-card-header">面板外的操作示例</div>
            <div class="layui-card-body">

                <div class="layui-btn-container LAY-senior-im-chat-demo">
                    <button class="layui-btn" data-type="chat">自定义会话</button>
                    <button class="layui-btn" data-type="message">接受好友的消息</button>
                    <button class="layui-btn" data-type="messageAudio">接受音频消息</button>
                    <button class="layui-btn" data-type="messageVideo">接受视频消息</button>
                    <button class="layui-btn" data-type="messageTemp">接受临时会话消息</button>

                    <br>

                    <button class="layui-btn" data-type="add">申请好友</button>
                    <button class="layui-btn" data-type="addqun">申请加群</button>
                    <button class="layui-btn" data-type="addFriend">同意好友</button>
                    <button class="layui-btn" data-type="addGroup">增加群组到主面板</button>
                    <button class="layui-btn" data-type="removeFriend">删除主面板好友</button>
                    <button class="layui-btn" data-type="removeGroup">删除主面板群组</button>

                    <br>
                    <button class="layui-btn" data-type="setGray">置灰离线好友</button>
                    <button class="layui-btn" data-type="unGray">取消好友置灰</button>

                    <button class="layui-btn" data-type="kefu1">在线客服一</button>
                    <button class="layui-btn" data-type="kefu2">在线客服二</button>

                    <button class="layui-btn" data-type="mobile">移动端版本</button>
                </div>

            </div>
        </div>
    </div>

</div>

<div th:replace="~{front/common/common :: frontFooter}"></div>

<!-- 新建分组弹窗 -->
<script type="text/html" id="createFriendGroupDialog">
    <form class="layui-form model-form">
        <div class="layui-form-item">
            <label class="layui-form-label layui-form-required">分组名:</label>
            <div class="layui-input-block">
                <input type="text" name="friendGroupName" placeholder="请输入分组名" class="layui-input"
                       lay-verType="tips" lay-verify="required" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block text-right">
                <button class="layui-btn" lay-filter="createFriendGroupSubmit" lay-submit>保存</button>
                <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog">取消</button>
            </div>
        </div>
    </form>
</script>

<script type="text/html" id="blankFriendGroup">
    <li>
        <h5 data-id="{{ d.id }}" layim-event="spread" lay-type="false"><i class="layui-icon">&#xe602;</i>
            <span>{{ d.groupName }}</span><em>(<cite class="layim-count"> 0</cite>)</em>
        </h5>
        <ul class="layui-layim-list"><li class="layim-null">该分组下暂无好友</li></ul>
    </li>
</script>

<script type="text/javascript" th:src="@{/admin/assets/libs/layui/layui.js}" src="assets/libs/layui/layui.js"></script>
<script type="text/javascript" th:src="@{/admin/assets/js/common.js(v=318)}" src="assets/js/common.js?v=318"></script>
<script>
    layui.use(['layim', 'app', 'contextMenu', 'admin', 'form', 'laytpl', 'ClientWebSocket'], function () {
        var $ = layui.$,
            admin = layui.admin,
            app = layui.app,
            contextMenu = layui.contextMenu,
            layim = layui.layim,
            form = layui.form,
            laytpl = layui.laytpl;
        var socket;

        //演示自动回复
        var autoReplay = [
            '您好，我现在有事不在，一会再和您联系。',
            '你没发错吧？face[微笑] ',
            '洗澡中，请勿打扰，偷窥请购票，个体四十，团体八折，订票电话：一般人我不告诉他！face[哈哈] ',
            '你好，我是主人的美女秘书，有什么事就跟我说吧，等他回来我会转告他的。face[心] face[心] face[心] ',
            'face[威武] face[威武] face[威武] face[威武] ',
            '<（@￣︶￣@）>',
            '你要和我说话？你真的要和我说话？你确定自己想说吗？你一定非说不可吗？那你说吧，这是自动回复。',
            'face[黑线]  你慢慢说，别急……',
            '(*^__^*) face[嘻嘻] ，是贤心吗？'
        ];

        //基础配置
        layim.config({
            //初始化接口
            init: {
                url: '/chat/list',
                data: {}
            }
            //查看群员接口
            , members: {
                url: '/admin/json/layim/getMembers.json'
                , data: {}
            },
             uploadImage: {
                url: '/chat/upload/image',
                type: 'POST' // 默认post
            }
            , uploadFile: {
                url: '' //（返回的数据格式见下文）
                , type: '' //默认post
            }

            , isAudio: true //开启聊天工具栏音频
            , isVideo: true //开启聊天工具栏视频

            //扩展工具栏
            , tool: [{
                alias: 'code'
                , title: '代码'
                , icon: '&#xe64e;'
            }]

            //,brief: true //是否简约模式（若开启则不显示主面板）

            , title: '在线聊天' //自定义主面板最小化时的标题
            ,right: '16px' //主面板相对浏览器右侧距离
            //,minRight: '90px' //聊天面板最小化时相对浏览器右侧距离
            , initSkin: '3.jpg', //1-5 设置初始背景
            //,skin: ['aaa.jpg'] //新增皮肤
            //,isfriend: false //是否开启好友
            //,isgroup: false //是否开启群组
            //,min: true //是否始终最小化主面板，默认false
            //,notice: true //是否开启桌面消息提醒，默认false
            //,voice: false //声音提醒，默认开启，声音文件为：default.mp3

            msgbox: '/chat/msgbox',  //消息盒子页面地址，若不开启，剔除该项即可
            find: '/chat/find',  //发现页面地址，若不开启，剔除该项即可
            chatLog: '/admin/assets/libs/layui/css/modules/layim/html/chatlog.html' //聊天记录页面地址，若不开启，剔除该项即可

        });
        //监听在线状态的切换事件
        layim.on('online', function (status) {
            layer.msg(status);
        });

        //监听签名修改
        layim.on('sign', function (value) {
            layer.msg(value);
            app.ajax('/user/center/updateInfo', { description: value }, function (res) {
                app.successNotice('修改个人签名成功');
            });
        });
        //监听自定义工具栏点击，以添加代码为例
        layim.on('tool(code)', function (insert) {
            layer.prompt({
                title: '插入代码 - 工具栏扩展示例'
                , formType: 2
                , shade: 0
            }, function (text, index) {
                layer.close(index);
                insert('[pre class=layui-code]' + text + '[/pre]'); //将内容插入到编辑器
            });
        });

        //监听layim建立就绪
        layim.on('ready', function (res) {
            //console.log(res.mine);
            layim.msgbox(5); //模拟消息盒子有新消息，实际使用时，一般是动态获得
            initFriendContextMenu();
            initSocket();
            pullNotSignedChatFriendMsg();
        });
        //监听发送消息
        layim.on('sendMessage', function (data) {
            let { mine: self, to } = data;
            if (to.type === 'friend') {
                app.ajax('/chat/friend/msg/send', {
                    friendId: to.id,
                    content: self.content,
                    channelId: socket.channelId
                }, null, 'POST', function (res) {
                    // TODO 发送失败需要做出界面提示
                }, false);
            }
        });
        //监听查看群员
        layim.on('members', function (data) {
            //console.log(data);
        });

        //监听聊天窗口的切换
        layim.on('chatChange', function (res) {
            var type = res.data.type;
            console.log(res.data.id)
            if (type === 'friend') {
                //模拟标注好友状态
                //layim.setChatStatus('<span style="color:#FF5722;">在线</span>');
            } else if (type === 'group') {
                //模拟系统消息
                layim.getMessage({
                    system: true
                    , id: res.data.id
                    , type: "group"
                    , content: '模拟群员' + (Math.random() * 100 | 0) + '加入群聊'
                });
            }
        });

        // 初始化WebSocket
        function initSocket() {
            let onMsgReceived = function (msg) {
                let { msgType, data } = msg;
                if (data.receiverId !== layim.cache().mine.id) {
                    return;
                }
                if (msgType === app.MSG_TYPE.CHAT_FRIEND) {
                    let { friend, groupId } = findFriendFromCache(data.senderId);
                    layim.getMessage({
                        username: friend.username,
                        avatar: friend.avatar,
                        id: friend.id,
                        type: 'friend',
                        content: data.content,
                        timestamp: data.createTime
                    });
                    // 签收消息
                    app.ajax('/chat/friend/msg/sign', { msgIds: data.id }, null, 'POST', null, false);
                } else if (msgType === app.MSG_TYPE.CHAT_NOTIFICATION) {
                    if (data.senderId > 0) {
                        let { friend, groupId } = findFriendFromCache(data.senderId);
                        if (data.action === 'online') {
                            let content = `您的好友 ${friend.username} 在 ${app.formatDateTime(data.time)} 上线了！`;
                            app.noticeFromUser(friend.avatar, friend.username, content);
                            layim.setFriendStatus(friend.id, 'online');
                        } else if (data.action === 'offline') {
                            layim.setFriendStatus(friend.id, 'offline');
                        }
                    }
                }
            };
            socket = new layui.ClientWebSocket({
                channelType: app.CHANNEL_TYPE.CHAT,
                groupId: layim.cache().mine.id,
                onMsgReceived: onMsgReceived.bind(this)
            });
        }

        // 拉取未签收的好友私聊消息
        function pullNotSignedChatFriendMsg() {
            let signMsg = function (res) {
                if (res.data.length === 0) {
                    return;
                }
                // 界面提醒
                for (let msg of res.data) {
                    // TODO 如果在签收之前，对方已经把我删除了，那么friend为空
                    let { friend, groupId } = findFriendFromCache(msg.senderId);
                    layim.getMessage({
                        username: friend.username,
                        avatar: friend.avatar,
                        id: friend.id,
                        type: 'friend',
                        content: msg.content,
                        timestamp: msg.createTime
                    });
                }
                // 签收消息
                let msgIds = res.data.map(msg => msg.id).join();
                app.ajax('/chat/friend/msg/sign', { msgIds }, null, 'POST', null, false);
            };
            app.ajax('/chat/friend/msg/not_signed', {}, signMsg.bind(this), 'GET', null, false);
        }

        // 发送好友申请
        window.applyFriend = function (userId, username, photo) {
            layim.add({
                type: 'friend',
                username,
                avatar: photo,
                submit: function (group, remark, index) {
                    let params = {
                        receiverId: userId,
                        friendGroupId: parseInt(group),
                        content: remark,
                    };
                    if (params.friendGroupId === -1) {
                        delete params.friendGroupId;
                    }
                    app.ajax('/chat/friend/apply', params, function (res) {
                        layer.msg('好友申请已发送，请等待对方确认', {
                            icon: 1, shade: 0.5
                        }, function () {
                            layer.close(index);
                        });
                    });
                }
            });
        };

        // 同意添加好友
        window.addFriend = function (applyId, user, callback) {
            layim.setFriendGroup({
                type: 'friend',
                username: user.username,
                avatar: user.photo,
                group: layim.cache().friend, // 获取分组
                submit: function (group, index) {
                    app.ajax('/chat/apply/process', {
                        friendApplyId: applyId,
                        friendGroupId: parseInt(group),
                        action: 'agree'
                    }, function (res) {
                        // 将好友追加到主面板
                        layim.addList({
                            type: 'friend',
                            username: user.username,
                            avatar: user.photo,
                            groupid: group, //所在的分组id
                            id: user.id,  //好友ID
                            sign: user.sign //好友签名
                        });
                        layer.msg('已成功添加好友', { icon: 1, shade: 0.5 }, function () {
                            layer.close(index);
                        });
                        callback && callback(res);
                    }, 'POST', function (res) {
                        layer.close(index);
                        callback && callback(res);
                    });
                }
            });
        };

        // 创建好友分组
        function createFriendGroup () {
            admin.open({
                type: 1,
                title: '新建好友分组',
                fixed: true,
                offset: 'auto',
                content: $('#createFriendGroupDialog').html(),
                success: function (layero, dIndex) {
                    $(layero).children('.layui-layer-content').css('overflow', 'visible');
                    form.on('submit(createFriendGroupSubmit)', function (data) {
                        app.ajax('/chat/friend/group/create', data.field, function (res) {
                            // 先更新缓存
                            layim.cache().friend.push({
                                id: res.data.id,
                                groupname: res.data.groupName,
                                list: []
                            });
                            // 再更新界面
                            var html = laytpl($('#blankFriendGroup').html()).render(res.data);
                            $('ul.layim-list-friend > li:last').before(html);
                            // 重新初始化右键菜单
                            initFriendContextMenu();
                            layer.msg('已成功创建好友分组', { icon: 1, shade: 0.5 }, function () {
                                layer.close(dIndex);
                            });
                        });
                        return false;
                    });
                }
            });
        }

        // 删除好友分组
        function deleteFriendGroup (groupId, groupName) {
            layer.confirm(`确定删除分组 ${groupName} 吗？该组下的所有好友都将移至未分组！`, function (index) {
                app.ajax('/chat/friend/group/delete', {
                    friendGroupId: groupId
                }, function (res) {
                    // 先更新缓存
                    let groups = layim.cache().friend;
                    let groupIdx = groups.findIndex(item => item.id === parseInt(groupId));
                    let unGroup = groups.find(item => item.id === -1).list;
                    unGroup.push(...groups[groupIdx].list);
                    groups.splice(groupIdx, 1);
                    console.log(layim.cache().friend);
                    // 再更新界面
                    let srcGroupTitleDom = $(`h5[data-id="${groupId}"]`);
                    let unGroupTitleDom = $('h5[data-id="-1"]');
                    let friendsDom = srcGroupTitleDom.siblings('ul.layui-layim-list').children('li[data-type="friend"]');
                    let unGroupDom = unGroupTitleDom.siblings('ul.layui-layim-list');
                    if (friendsDom.length > 0 && unGroupDom.children('li.layim-null').length === 1) {
                        unGroupDom.children('li.layim-null').remove(); // 移除未分组中的"该分组下暂无好友"的提示
                    }
                    friendsDom.appendTo(unGroupDom); // 将源分组的好友移动至未分组下
                    unGroupDom.children('li[data-type="friend"]').each(function () {
                        $(this).data('index', groups.length - 1); // 纠正未分组下的好友的DOM节点的data-index
                    });
                    let groupCountDom = unGroupTitleDom.find('.layim-count');
                    let oldCount = groupCountDom.text().trim();
                    groupCountDom.text(parseInt(oldCount) + friendsDom.length); // 修改未分组的好友数量显示
                    srcGroupTitleDom.parent('li').remove(); // 移除源分组
                    // 重新初始化右键菜单
                    initFriendContextMenu();
                    layer.msg('已成功删除好友分组', { icon: 1, shade: 0.5 }, function () {
                        layer.close(index);
                    });
                }, 'POST', function (res) {
                    layer.close(index); // 删除失败的时候，把确认弹窗给关闭掉
                });
            });
        }

        // 删除好友
        function deleteFriend (friendId, friendName) {
            layer.confirm(`确定删除好友 ${friendName} 吗？您也将会从对方好友列表中消失！`, function (index) {
               app.ajax('/chat/friend/delete', { friendId }, function (res) {
                   layim.removeList({ id: friendId, type: 'friend' });
                   layer.msg('已成功删除好友', { icon: 1, shade: 0.5 }, function () {
                       layer.close(index);
                   });
               }, 'POST', function (res) {
                   layer.close(index);
               });
            });
        }

        // 移动好友
        function moveFriendToOtherGroup (friend, targetGroupId, targetGroupName) {
            let params = { friendIds: friend.id, targetFriendGroupId: parseInt(targetGroupId) };
            if (params.targetFriendGroupId === -1) {
                delete params.targetFriendGroupId; // 如果移动至未分组，不需要targetFriendGroupId属性
            }
            layer.confirm(`确定将好友 ${friend.username} 移动至分组 ${targetGroupName} 吗？`, function (index) {
                app.ajax('/chat/friend/move', params, function (res) {
                    layim.removeList({ id: friend.id, type: 'friend' }); // 先移除好友信息
                    // 重新添加好友到指定分组
                    layim.addList({
                        type: 'friend',
                        username: friend.username,
                        avatar: friend.avatar,
                        groupid: targetGroupId + '',  // 目标分组的id
                        id: friend.id, // 好友的用户ID
                        sign: friend.sign  //好友签名
                    });
                    // 重新初始化右键菜单
                    initFriendContextMenu();
                    layer.msg('已成功移动好友', { icon: 1, shade: 0.5 }, function () {
                        layer.close(index);
                    });
                }, 'POST', function (res) {
                    layer.close(index);
                });
            });
        }

        // 初始化右键菜单
        function initFriendContextMenu () {
            let createGroupItem = {
                icon: 'layui-icon layui-icon-add-circle',
                name: '创建分组',
                click: createFriendGroup
            };
            let blankCtxMenus = [{
                icon: 'layui-icon layui-icon-refresh',
                name: '刷新好友列表',
                click: function () {
                    app.errorNotice('暂不支持');
                }
            }, createGroupItem];
            let groupCtxMenus = [createGroupItem, {
                icon: 'layui-icon layui-icon-delete',
                name: '删除分组',
                click: function (ev1, ev2) {
                    let groupTitleDom = $(ev2.currentTarget).children('h5');
                    let groupId = groupTitleDom.data('id');
                    let groupName = groupTitleDom.children('span').text();
                    deleteFriendGroup(groupId, groupName);
                }
            }];
            let subs = layim.cache().friend.map(item => {
                return {
                    id: item.id,
                    name: item.groupname,
                    click: function (ev1, ev2) {
                        let friendName = $(ev2.currentTarget).children('span:first').text();
                        let friendId = $(ev2.currentTarget).data('id');
                        let { friend, groupId: sourceGroupId } = findFriendFromCache(friendId);
                        let targetGroupId = this.id;
                        if (parseInt(sourceGroupId) === parseInt(targetGroupId)) {
                            app.errorNotice('无须移动');
                            return;
                        }
                        moveFriendToOtherGroup(friend, targetGroupId, this.name);
                    }
                }
            });
            let friendCtxMenus = [{
                icon: 'layui-icon layui-icon-delete',
                name: '删除好友',
                click: function (ev1, ev2) {
                    let friendId = $(ev2.currentTarget).data("id");
                    let friendName = $(ev2.currentTarget).children('span:first').text();
                    deleteFriend(friendId, friendName);
                }
            }, {
                icon: 'layui-icon layui-icon-next',
                name: '移动至',
                subs
            }];
            contextMenu.bind('ul.layim-list-friend', blankCtxMenus);
            contextMenu.bind('ul.layim-list-friend > li', groupCtxMenus);
            contextMenu.bind('ul.layui-layim-list > li[data-type="friend"]', friendCtxMenus);
        }

        // 根据用户id查询好友信息
        function findFriendFromCache(friendId) {
            let friend, groupId;
            for (let group of layim.cache().friend) {
                friend = group.list.find(item => item.id === parseInt(friendId));
                if (friend) {
                    groupId = group.id;
                    break;
                }
            }
            return { friend, groupId };
        }

        //面板外的操作
        var $ = layui.jquery, active = {
            chat: function () {
                //自定义会话
                layim.chat({
                    name: '小闲'
                    , type: 'friend'
                    , avatar: '//tva3.sinaimg.cn/crop.0.0.180.180.180/7f5f6861jw1e8qgp5bmzyj2050050aa8.jpg'
                    , id: 1008612
                });
                layer.msg('也就是说，此人可以不在好友面板里');
            }
            , message: function () {
                //制造好友消息
                layim.getMessage({
                    username: "贤心"
                    , avatar: "//tp1.sinaimg.cn/1571889140/180/40030060651/1"
                    , id: "100001"
                    , type: "friend"
                    , content: "嗨，你好！欢迎体验LayIM。演示标记：" + new Date().getTime()
                    , timestamp: new Date().getTime()
                });
            }
            , messageAudio: function () {
                //接受音频消息
                layim.getMessage({
                    username: "林心如"
                    , avatar: "//tp3.sinaimg.cn/1223762662/180/5741707953/0"
                    , id: "76543"
                    , type: "friend"
                    , content: "audio[http://gddx.sc.chinaz.com/Files/DownLoad/sound1/201510/6473.mp3]"
                    , timestamp: new Date().getTime()
                });
            }
            , messageVideo: function () {
                //接受视频消息
                layim.getMessage({
                    username: "林心如"
                    , avatar: "//tp3.sinaimg.cn/1223762662/180/5741707953/0"
                    , id: "76543"
                    , type: "friend"
                    , content: "video[http://www.w3school.com.cn//i/movie.ogg]"
                    , timestamp: new Date().getTime()
                });
            }
            , messageTemp: function () {
                //接受临时会话消息
                layim.getMessage({
                    username: "小酱"
                    , avatar: "//tva1.sinaimg.cn/crop.7.0.736.736.50/bd986d61jw8f5x8bqtp00j20ku0kgabx.jpg"
                    , id: "198909151014"
                    , type: "friend"
                    , content: "临时：" + new Date().getTime()
                });
            }
            // 发送好友申请
            , add: function () {
                //实际使用时数据由动态获得
                layim.add({
                    type: 'friend'
                    , username: '麻花疼'
                    , avatar: '//tva1.sinaimg.cn/crop.0.0.720.720.180/005JKVuPjw8ers4osyzhaj30k00k075e.jpg'
                    , submit: function (group, remark, index) {
                        layer.msg('好友申请已发送，请等待对方确认', {
                            icon: 1
                            , shade: 0.5
                        }, function () {
                            layer.close(index);
                        });

                        //通知对方
                        /*
                        $.post('/im-applyFriend/', {
                          uid: info.uid
                          ,from_group: group
                          ,remark: remark
                        }, function(res){
                          if(res.status != 0){
                            return layer.msg(res.msg);
                          }
                          layer.msg('好友申请已发送，请等待对方确认', {
                            icon: 1
                            ,shade: 0.5
                          }, function(){
                            layer.close(index);
                          });
                        });
                        */
                    }
                });
            }
            , addqun: function () {
                layim.add({
                    type: 'group'
                    , username: 'LayIM会员群'
                    , avatar: '//tva2.sinaimg.cn/crop.0.0.180.180.50/6ddfa27bjw1e8qgp5bmzyj2050050aa8.jpg'
                    , submit: function (group, remark, index) {
                        layer.msg('申请已发送，请等待管理员确认', {
                            icon: 1
                            , shade: 0.5
                        }, function () {
                            layer.close(index);
                        });

                        //通知对方
                        /*
                        $.post('/im-applyGroup/', {
                          uid: info.uid
                          ,from_group: group
                          ,remark: remark
                        }, function(res){

                        });
                        */
                    }
                });
            }
            // 同意添加好友
            , addFriend: function () {
                var user = {
                    type: 'friend'
                    , id: 1234560
                    , username: '李彦宏' //好友昵称，若申请加群，参数为：groupname
                    , avatar: '//tva4.sinaimg.cn/crop.0.0.996.996.180/8b2b4e23jw8f14vkwwrmjj20ro0rpjsq.jpg' //头像
                    , sign: '全球最大的中文搜索引擎'
                }
                layim.setFriendGroup({
                    type: user.type
                    , username: user.username
                    , avatar: user.avatar
                    , group: layim.cache().friend //获取好友列表数据
                    , submit: function (group, index) {
                        //一般在此执行Ajax和WS，以通知对方已经同意申请
                        //……

                        //同意后，将好友追加到主面板
                        layim.addList({
                            type: user.type
                            , username: user.username
                            , avatar: user.avatar
                            , groupid: group //所在的分组id
                            , id: user.id //好友ID
                            , sign: user.sign //好友签名
                        });

                        layer.close(index);
                    }
                });
            }
            , addGroup: function () {
                layer.msg('已成功把[Angular开发]添加到群组里', {
                    icon: 1
                });
                //增加一个群组
                layim.addList({
                    type: 'group'
                    , avatar: "//tva3.sinaimg.cn/crop.64.106.361.361.50/7181dbb3jw8evfbtem8edj20ci0dpq3a.jpg"
                    , groupname: 'Angular开发'
                    , id: "12333333"
                    , members: 0
                });
            }
            , removeFriend: function () {
                layer.msg('已成功删除[凤姐]', {
                    icon: 1
                });
                //删除一个好友
                layim.removeList({
                    id: 121286
                    , type: 'friend'
                });
            }
            , removeGroup: function () {
                layer.msg('已成功删除[前端群]', {
                    icon: 1
                });
                //删除一个群组
                layim.removeList({
                    id: 101
                    , type: 'group'
                });
            }
            //置灰离线好友
            , setGray: function () {
                layim.setFriendStatus(168168, 'offline');

                layer.msg('已成功将好友[马小云]置灰', {
                    icon: 1
                });
            }
            //取消好友置灰
            , unGray: function () {
                layim.setFriendStatus(168168, 'online');

                layer.msg('成功取消好友[马小云]置灰状态', {
                    icon: 1
                });
            }

            , kefu1: function () {
                layim.chat({
                    name: '在线客服一' //名称
                    , type: 'kefu' //聊天类型
                    , avatar: '//tp1.sinaimg.cn/5619439268/180/40030060651/1' //头像
                    , id: 1111111 //定义唯一的id方便你处理信息
                })
            }
            , kefu2: function () {
                layim.chat({
                    name: '在线客服二' //名称
                    , type: 'kefu' //聊天类型
                    , avatar: '//tp1.sinaimg.cn/5619439268/180/40030060651/1' //头像
                    , id: 2222222 //定义唯一的id方便你处理信息
                });
            }

            //移动端版本
            , mobile: function () {
                var device = layui.device();
                var mobileHome = 'mobile.html';
                if (device.android || device.ios) {
                    return location.href = mobileHome;
                }
                var index = layer.open({
                    type: 2
                    , title: '移动版演示 （或手机扫右侧二维码预览）'
                    , content: mobileHome
                    , area: ['375px', '667px']
                    , shadeClose: true
                    , shade: 0.8
                    , end: function () {
                        layer.close(index + 2);
                    }
                });
                layer.photos({
                    photos: {
                        "data": [{
                            "src": "http://cdn.layui.com/upload/2016_12/168_1481056358469_50288.png",
                        }]
                    }
                    , anim: 0
                    , shade: false
                    , success: function (layero) {
                        layero.css('margin-left', '350px');
                    }
                });
            }
        };
        $('.LAY-senior-im-chat-demo .layui-btn').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });
</script>
